{%extends 'base\base.html'%}
{% block start%}

<div class="container" style="margin-top:2rem">
    <hr>
    <div class="row">
        <div class="col-md-6">
            <h3>Items in Cart</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>S.N.</th>
                        <th>Product</th>
                        <th>Price</th>
                        
                    </tr>
                </thead>
                <tbody>
                    {%for item in items%}
                    <tr>
                        <td>{{forloop.counter}}</td>
                        <td>{{item.product.product_name}}</td>
                        <td>Rs {{item.product.price}}</td>
                    </tr>
                    {%endfor%}
                </tbody>
            </table>
            <hr>
            <p class="text-right"><b>Total : Rs {{cart.get_cart_total}}</b></p>
            </div>   
    </div>
<hr>
    <div class="row">
    <div class="col-md-6">
        <h3>Checkout Form</h3>
        
        <hr>
            <form>
                 
                  {% include "base/alert.html" %}   <!-- for messages-->
              <div class="form-group">
                    <label> <h5>Ordered by</h5></label>
                     <input name="username" value = "{{request.user.first_name | title}}  {{request.user.last_name | title}}"class="form-control" placeholder="Ordered by" type="text" required>
                    </div> <!-- form-group// -->

                    <div class="form-group">
                        <label> <h5>Email </h5></label>
                        <input name="email" value = "{{request.user.email}}" class="form-control" placeholder="Mobile Number" type="text" required>
                      </div> <!-- form-group// -->

                  <div class="form-group">
                    <label> <h5>Mobile Number</h5></label>
                    <input name="mobile" value = "{{request.user.profile.mobile}}" class="form-control" placeholder="Mobile Number" type="text" required>
                  </div> <!-- form-group// -->

                  <div class="form-group">
                    <label> <h5>Shipping Address</h5></label>
                    <input name="address" value = "{{request.user.profile.address}}" class="form-control" placeholder="Shipping Address" type="text" required>
                  </div> <!-- form-group// -->

                  <div class="form-group">
                  <select name="payment" class="dropdown">
                    {%for i, j in payments %}
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <option class="dropdown-item" value = "{{i}}" {%if i == order.order_status%}selected{%endif%}>{{j}}</option>
                    </div>
    
                    {%endfor%}
                   </select>
                </div> <!-- form-group// -->

                  <div class="form-group">
                    <button id="payment-button">Pay with Khalti</button>
                  </div> <!-- form-group// -->    
              </form> 
             

              
        </div>
    </div>
</div>
<script src="https://khalti.s3.ap-south-1.amazonaws.com/KPG/dist/2020.12.17.0.0.0/khalti-checkout.iffe.js"></script>
              <script>
                var config = {
                    // replace the publicKey with yours
                    "publicKey": "test_public_key_b0e3cbc8b2a745b1b7a2bfb78c4b778b",
                    "productIdentity": "1234567890",
                    "productName": "Dragon",
                    "productUrl": "http://gameofthrones.wikia.com/wiki/Dragons",
                    "paymentPreference": [
                        "KHALTI",
                        "EBANKING",
                        "MOBILE_BANKING",
                        "CONNECT_IPS",
                        "SCT",
                        ],
                    "eventHandler": {
                        onSuccess (payload) {
                            // hit merchant api for initiating verfication
                            console.log(payload);
                        },
                        onError (error) {
                            console.log(error);
                        },
                        onClose () {
                            console.log('widget is closing');
                        }
                    }
                };
        
                var checkout = new KhaltiCheckout(config);
                var btn = document.getElementById("payment-button");
                btn.onclick = function () {
                    // minimum transaction amount must be 10, i.e 1000 in paisa.
                    checkout.show({amount: 1000});
                }
            </script>
{% endblock%}